<!DOCTYPE html>
<html lang="en">

<head>

  <title>Melting your phyloseq object with dplyr/tidyr</title>
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- Open Graph tags -->
  <meta property="og:locale" content="en_US">
  <meta property="og:site_name" content="SITENAME"/>
  <meta property="article:author" content="Chuck Pepe-Ranney"/>

  <!-- Twitter card tags -->
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:creator" content="@chuckpr"/>

  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/>

  <link rel="stylesheet" type="text/css" href="https://chuckpr.github.io/theme/css/site.css">

  <link rel="shortcut icon" type="image/x-icon" href="https://chuckpr.github.io/favicon.ico"/>
  <link rel="icon" type="image/x-icon" href="https://chuckpr.github.io/favicon.ico"/>


  <meta itemprop="description"
        name="description"
        content="If you're a microbial ecologist and you haven't used phyloseq, put away your vintage scarf …"/>

  <!-- Open Graph tags -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Melting your phyloseq object with dplyr/tidyr"/>
  <meta property="og:url" content="https://chuckpr.github.io/posts/melt/"/>
  <meta property="article:published_time" content="2015-04-20 00:00:00-04:00"/>
  <meta property="og:description"
        content="If you're a microbial ecologist and you haven't used phyloseq, put away your vintage scarf …"/>

  <!-- Twitter card tags -->
  <meta name="twitter:title" content="Melting your phyloseq object with dplyr/tidyr">
  <meta name="twitter:description"
        content="If you're a microbial ecologist and you haven't used phyloseq, put away your vintage scarf …"/>

  <link rel="canonical" href="https://chuckpr.github.io/posts/melt/">

  <link rel="stylesheet" type="text/css" href="https://chuckpr.github.io/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="https://chuckpr.github.io/theme/css/article.css">
  <link rel="stylesheet" type="text/css" href="https://chuckpr.github.io/theme/css/notebook.css">

</head>

<body>
  <header class="flex flex-column avenir mw7 ml-auto mr-auto">
<div class="pt5 pb2">
  <a href="https://chuckpr.github.io/" class="link dim f2-ns f3 fw4 blue tracked-tight bb-l bw1-ns lh-title b--moon-gray">
    A microbiologist with a data science problem
  </a>
</div>  </header>
  <main class="mw7 ml-auto mr-auto ph3 flex flex-column min-vh-100">
  <article class="flex flex-column">
    <section id="article-title" class="flex justify-between mt4 avenir bb b--moon-gray pb2">
      <div>
        <div class="flex flex-column">
          <div>
            <p class="f3-ns f4 mv0 lh-title">
              Melting your phyloseq object with dplyr/tidyr
            </p>
          </div>
          <div class="ml3">
            <p class="f6 ttc mb0 mt1 mid-gray">
              Mon 20 April 2015
            </p>
          </div>
        </div>
      </div>
      <div class="w-40">
        <div class="flex flex-wrap justify-end">
<div class="mv1 mr2 bg-light-green br3 pa2 grow">
  <a href="https://chuckpr.github.io/tag/r" class="link dark-pink underline-hover fw5">
      #R
  </a>
</div><div class="mv1 mr2 bg-light-green br3 pa2 grow">
  <a href="https://chuckpr.github.io/tag/amplicon" class="link dark-pink underline-hover fw5">
      #amplicon
  </a>
</div>        </div>
      </div>
    </section>
    <section id="article-content" class="ph3 garamond near-black" style="font-size: 17px">
      <p>If you're a microbial ecologist and you haven't used <a href="http://joey711.github.io/phyloseq/">phyloseq</a>, put away your vintage scarf and thick-rimmed glasses because you are not hip. <a href="http://joey711.github.io/phyloseq/">phyloseq</a> is the nexus of all that is good in the universe. In this post we'll look at one of the greatest <a href="http://joey711.github.io/phyloseq/">phyloseq</a> functions, <code>psmelt</code>. <code>psmelt</code> combines your sample info, OTU counts, and taxonomic annotations into a single dataframe where every row represents an OTU-sample combination. Hhhhwhat!?! Amazing, I know. From this omnipotent dataframe you can do anything. So, how do we use <code>psmelt</code>? And can we re-create <code>psmelt</code> with <a href="https://github.com/hadley/dplyr">dplyr</a> and <a href="https://github.com/hadley/tidyr">tidyr</a>?</p>



<p>Let's start by bringing in some R packages and loading the <code>rmagic</code> extension for IPython.</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">library</span><span class="p">(</span><span class="n">phyloseq</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">);</span> <span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>
Attaching package: ‘dplyr’

The following object is masked from ‘package:stats’:

    filter

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union


Attaching package: ‘magrittr’

The following object is masked from ‘package:tidyr’:

    extract

Use suppressPackageStartupMessages to eliminate package startup messages.
</pre>
</div>

</div>

</div>
</div>

</div>

<p>I'm going to use data from a paper we recently submitted. See the pre-print <a href="http://dx.doi.org/10.1101/013813">here</a> if you're interested. A typical microbiome data set consists of three tables:</p>



<ol>
<li>A table of sample information.</li>
<li>A table of OTU counts in the samples.</li>
<li>A table of taxonomic info for each OTU.</li>
</ol>



<p>In this example the OTU counts and taxonomic info are combined in a json <a href="http://biom-format.org/">biom</a> formatted table. We have the sample information in a <a href="http://qiime.org/">QIIME</a> formatted sample metadata table. Don't get bogged down in the file formats, however. They're just tables and you can get tables into R easily. Focus on the concepts and what information you need to do an analysis.</p>



<p>We'll write a quick function to handle the <a href="http://qiime.org/">QIIME</a> formatted sample data table (<strong>note how we're just using the base R <code>read.table</code> function</strong>) and we'll use the <code>import_biom</code> function from <a href="http://joey711.github.io/phyloseq/">phyloseq</a> to import our OTU counts and OTU taxonomic annotations. We'll combine all the info into a <code>phyloseq object</code>.</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">read.qiime</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">read.table</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;\t&quot;</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">rename</span><span class="p">(</span><span class="n">SampleID</span> <span class="o">=</span> <span class="n">X.SampleID</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="p">{</span><span class="nf">rownames</span><span class="p">(</span><span class="n">.)</span> <span class="o">=</span> <span class="n">.$SampleID</span><span class="p">;</span> <span class="n">.}</span> <span class="o">%&gt;%</span>
    <span class="n">data.frame</span> <span class="o">%&gt;%</span> <span class="n">sample_data</span>
<span class="p">}</span>

<span class="n">physeq</span> <span class="o">=</span> <span class="nf">import_biom</span><span class="p">(</span><span class="s">&quot;data/otu_table_wtax.biom&quot;</span><span class="p">)</span>
<span class="nf">sample_data</span><span class="p">(</span><span class="n">physeq</span><span class="p">)</span> <span class="o">=</span> <span class="nf">read.qiime</span><span class="p">(</span><span class="s">&quot;data/sample_data_combined_qiime_format.tsv&quot;</span><span class="p">)</span>
<span class="n">physeq</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 4340 taxa and 158 samples ]
sample_data() Sample Data:       [ 158 samples by 46 sample variables ]
tax_table()   Taxonomy Table:    [ 4340 taxa by 8 taxonomic ranks ]
</pre>
</div>

</div>

</div>
</div>

</div>

<p>Great! Now let's <strong>melt</strong> all that information into an <strong>all-powerful, all-knowing, benevolent</strong> dataframe. (Evil laugh)</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">mdf</span> <span class="o">=</span> <span class="nf">psmelt</span><span class="p">(</span><span class="n">physeq</span><span class="p">)</span>
<span class="n">mdf</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">OTU</span><span class="p">,</span> <span class="n">SampleID</span><span class="p">,</span> <span class="n">Abundance</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>              OTU  SampleID Abundance
20025    OTU.1106 4502024.3      2233
288    DQ531697.1    site16      2147
19962    OTU.1106    site19      1505
272    DQ531697.1    site15      1426
310    DQ531697.1    site17      1278
456836     OTU.36    site19      1268
</pre>
</div>

</div>

</div>
</div>

</div>

<p>To keep this post short, I won't demonstrate where you can go from a melted <code>phyloseq object</code>. Suffice to say that you can go anywhere with your melted <code>phyloseq object</code>/dataframe. Think of it like a <a href="https://www.youtube.com/watch?v=qJJog4BJrUw">magic carpet</a>.</p>



<p>With really big OTU tables, melting can take a long time...</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">system.time</span><span class="p">(</span><span class="nf">psmelt</span><span class="p">(</span><span class="n">physeq</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>   user  system elapsed 
 22.660   0.056  22.728 
</pre>
</div>

</div>

</div>
</div>

</div>

<p>It takes about 30-ish seconds with our example phyloseq object with the <code>psmelt</code> function. I wonder how fast <a href="https://github.com/hadley/dplyr">dplyr</a> + <a href="https://github.com/hadley/tidyr">tidyr</a> can melt our phyloseq object?</p>



<p>Let's re-create the <code>psmelt</code> function with <a href="https://github.com/hadley/dplyr">dplyr</a> + <a href="https://github.com/hadley/tidyr">tidyr</a>.</p>



<p>We need to,</p>



<ol>
<li>get our tables (sample data, OTU counts, taxonomy),</li>
<li>combine our taxonomic info with our OTU counts,</li>
<li>gather this combined table into a long form version, and</li>
<li>add in the sample data.</li>
</ol>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">psmelt.dplyr</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">physeq</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="nf">sample_data</span><span class="p">(</span><span class="n">physeq</span><span class="p">))</span>
    <span class="n">TT</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="nf">tax_table</span><span class="p">(</span><span class="n">physeq</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">add_rownames</span><span class="p">(</span><span class="s">&quot;OTU&quot;</span><span class="p">)</span>
    <span class="n">otu.table</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="nf">otu_table</span><span class="p">(</span><span class="n">physeq</span><span class="p">),</span> <span class="n">check.names</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">add_rownames</span><span class="p">(</span><span class="s">&quot;OTU&quot;</span><span class="p">)</span>
    <span class="n">otu.table</span> <span class="o">%&gt;%</span>
        <span class="nf">left_join</span><span class="p">(</span><span class="n">TT</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="nf">gather_</span><span class="p">(</span><span class="s">&quot;SampleID&quot;</span><span class="p">,</span> <span class="s">&quot;Abundance&quot;</span><span class="p">,</span> <span class="nf">setdiff</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">otu.table</span><span class="p">),</span> <span class="s">&quot;OTU&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="nf">left_join</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">mdf.dplyr</span> <span class="o">=</span> <span class="nf">psmelt.dplyr</span><span class="p">(</span><span class="n">physeq</span><span class="p">)</span>
<span class="n">mdf.dplyr</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">OTU</span><span class="p">,</span> <span class="n">SampleID</span><span class="p">,</span> <span class="n">Abundance</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">head</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>Joining by: &#34;OTU&#34;
Joining by: &#34;SampleID&#34;
       OTU SampleID Abundance
1  OTU.758    G4F20         2
2 OTU.2942    G4F20         0
3  OTU.753    G4F20         0
4  OTU.752    G4F20         0
5  OTU.751    G4F20         0
6  OTU.750    G4F20         0
</pre>
</div>

</div>

</div>
</div>

</div>

<p>...and let's see how fast it is.</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">system.time</span><span class="p">(</span><span class="nf">psmelt.dplyr</span><span class="p">(</span><span class="n">physeq</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>Joining by: &#34;OTU&#34;
Joining by: &#34;SampleID&#34;
   user  system elapsed 
   1.04    0.00    1.04 
</pre>
</div>

</div>

</div>
</div>

</div>

<h3 id="Wow.-Roughly-an-order-of-magnitude-faster.-dplyr-and-tidyr-are-so-great.-And-look-at-that-syntax!">Wow. Roughly an order of magnitude faster. dplyr and tidyr are so great. And look at that syntax!<a class="anchor-link" href="#Wow.-Roughly-an-order-of-magnitude-faster.-dplyr-and-tidyr-are-so-great.-And-look-at-that-syntax!"> &#182;</a></h3>


<p>I shold note that I'm using phyloseq version <strong>1.9.15</strong> in this demo.</p>



<p>The <code>psmelt</code> function is so useful (and much more rigorous/fool-proof than our quick dplyr/tidyr version) but if you have a huge phyloseq object that takes forever to melt, try dplyr + tidyr.</p>



<p>Let's do one quick example from the melted <code>phyloseq object</code> to give you a taste of how useful it is. Let's say we want to make phylum level stacked bar charts for all the studies in the example data. Here's how you might do it from the melted <code>phyloseq object</code>.</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">w</span> <span class="m">1200</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mdf.dplyr</span> <span class="o">%&gt;%</span>
    <span class="nf">group_by</span><span class="p">(</span><span class="n">SampleID</span><span class="p">,</span> <span class="n">Rank2</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">filter</span><span class="p">(</span><span class="n">Abundance</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">summarize</span><span class="p">(</span><span class="n">rank2.abund</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">Abundance</span><span class="p">),</span> <span class="n">study</span> <span class="o">=</span> <span class="nf">first</span><span class="p">(</span><span class="n">study</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">relative.abundance</span> <span class="o">=</span> <span class="n">rank2.abund</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">rank2.abund</span><span class="p">))</span>

<span class="n">p</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">SampleID</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">relative.abundance</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">Rank2</span><span class="p">))</span> <span class="o">+</span>
    <span class="nf">facet_grid</span><span class="p">(</span><span class="n">.~study</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="s">&quot;free&quot;</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s">&quot;free&quot;</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">0.85</span><span class="p">)</span> <span class="o">+</span> 
    <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">,</span> <span class="n">strip.background</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span>
<span class="n">p</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="https://chuckpr.github.io/notebooks/images/output_26_0.png"
>
</div>

</div>

</div>
</div>

</div>

<p>Snap.</p>


<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">pckgs</span>  <span class="o">=</span> <span class="nf">lapply</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="nf">sessionInfo</span><span class="p">()</span><span class="o">$</span><span class="n">otherPkgs</span><span class="p">),</span> <span class="n">packageVersion</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">pckgs</span><span class="p">)</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="nf">sessionInfo</span><span class="p">()</span><span class="o">$</span><span class="n">otherPkgs</span><span class="p">)</span>
<span class="nf">data.frame</span><span class="p">(</span><span class="n">pckgs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>  ggplot2 magrittr tidyr dplyr phyloseq
1   1.0.0      1.5 0.2.0 0.4.1   1.9.15
</pre>
</div>

</div>

</div>
</div>

</div>
 


    </section>
<div id="disqus_thread" class="mt4">
</div>
<script>

  var disqus_config = function () {
    this.page.url = 'https://chuckpr.github.io/posts/melt/';
    this.page.identifier = 'posts/melt/';
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://chuckpr-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();

</script>
<noscript>
  Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">
    comments powered by Disqus.
  </a>
</noscript>  </article>
  </main>
  <footer class="pv3 flex justify-between mt4 mb2 mw7 ml-auto mr-auto avenir">
    <div class="flex flex-column pl3">
      <div class="mid-gray fw4 f6-ns f7 mb2">
        Copyright &copy; 2020 Chuck&nbsp;Pepe&#8209;Ranney
      </div>
      <div class="mid-gray" style="font-size: 0.65rem;">
        Powered&nbsp;by&nbsp;<a href="https://getpelican.com/" class="link dim
          mid-gray f6 fw6">Pelican</a>,
        Theme&nbsp;by&nbsp;<a href="https://github.com/chuckpr/simple-pelican-blog-theme"
          class="link dim mid-gray fw6">@chuckpr</a>
      </div>
    </div>
    <div class="flex justify-end w-50-ns w-30 mr4-ns mr0 ml2">
            <div class="w-10-ns w2 ml2 grow">
              <a href="https://github.com/chuckpr" class="light-purple dim link">
                <div class="o-50 pa1-l">
<svg viewBox="0 0 24 24" fill="currentColor">
  <title>GitHub icon</title>
  <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
</svg>                </div>
              </a>
            </div>
            <div class="w-10-ns w2 ml2 grow">
              <a href="https://www.linkedin.com/in/chuckpr/" class="light-purple dim link">
                <div class="o-50 pa1-l">
<svg viewBox="0 0 24 24" fill="currentColor">
  <title>LinkedIn icon</title>
  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
</svg>                </div>
              </a>
            </div>
            <div class="w-10-ns w2 ml2 grow">
              <a href="https://twitter.com/chuck_pr" class="light-purple dim link">
                <div class="o-50 pa1-l">
<svg viewBox="0 0 24 24" fill="currentColor">
  <title>Twitter icon</title>
  <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/>
</svg>                </div>
              </a>
            </div>
    </div>
  </footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>

  console.log('Adding toggle buttons');
  var $toggleCodeButton = $('\
    <a class="toggle toggle-code" href="#0">\
      toggle code\
    </a>\
  ')

  var $toggleAllButton = $('\
    <div>\
      <a class="toggle toggle-all" href="#0">\
        show me\
      </a>\
    </div>\
  ')

  // This adds the buttons
  $(document).ready(function(){

    $cellToggleCode = $('.celltag_toggle_code')
    $cellToggleCode.find('.input').css('display', 'none');
    $toggleCodeButton.prependTo($cellToggleCode);

    $cellToggleAll = $('.celltag_toggle_all');
    $cellToggleAll.css('display', 'none');
    $toggleAllButton.insertBefore($cellToggleAll);

    $('.celltag_disappear').css('display', 'none');

  });

  // These add the toggle behavior for the buttons
  $(document).ready(function(){
    $('a.toggle-code').click(function(){
      $(this).next('.input').slideToggle();
    });
  })

  $(document).ready(function(){
    $('a.toggle-all').click(function(){
      $(this).parent().next('div').slideToggle();
    });
  })

</script></body>

</html>